{% extends "adminpanel/base_admin.html" %}
{% load static %}

{% block content %}

<h2 class="text-2xl font-semibold mb-4">
  {% if product %}Edit Product{% else %}Add Product{% endif %}
</h2>

<form method="POST" enctype="multipart/form-data"
      class="bg-white p-6 rounded-lg shadow max-w-3xl space-y-6">

    {% csrf_token %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

        <div>
            <label for="id_name">Name:</label>
            {{ form.name }}
            {% for error in form.name.errors %}
                <p class="text-red-600 text-sm">{{ error }}</p>
            {% endfor %}
        </div>

        <div>
            <label for="id_brand">Brand:</label>
            {{ form.brand }}
            {% for error in form.brand.errors %}
                <p class="text-red-600 text-sm">{{ error }}</p>
            {% endfor %}
        </div>

        <div>
            <label for="id_category">Category:</label>
            {{ form.category }}
            {% for error in form.category.errors %}
                <p class="text-red-600 text-sm">{{ error }}</p>
            {% endfor %}
        </div>

        <div>
            <label for="id_price">Price:</label>
            {{ form.price }}
            {% for error in form.price.errors %}
                <p class="text-red-600 text-sm">{{ error }}</p>
            {% endfor %}
        </div>

        <div>
            <label for="id_discount_price">Discount Price:</label>
            {{ form.discount_price }}
            {% for error in form.discount_price.errors %}
                <p class="text-red-600 text-sm">{{ error }}</p>
            {% endfor %}
        </div>

    </div>

    <div>
        <label for="id_description">Description:</label>
        {{ form.description }}
        {% for error in form.description.errors %}
            <p class="text-red-600 text-sm">{{ error }}</p>
        {% endfor %}
    </div>

    <div class="flex items-center gap-2 mt-3">
        <label for="id_active" class="font-semibold">Active:</label>
        {{ form.active }}
        {% if form.active.errors %}
            <p class="text-red-600 text-sm">{{ form.active.errors.0 }}</p>
        {% endif %}
    </div>

    <div>
        <label class="font-semibold block mb-2">Upload Product Images (Minimum 3 Images)</label>
        <input type="file" name="images" id="id_images" multiple required accept="image/*"
               class="border p-2 rounded w-full bg-white">

        {% if image_errors %}
            <p class="text-red-600 text-sm mt-1">{{ image_errors }}</p>
        {% endif %}
    </div>

    {% if images %}
    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
        {% for img in images %}
            <div class="relative group">
                <img src="{{ img.image.url }}" class="h-32 w-full object-cover rounded shadow">
                <a href="{% url 'admin_product_image_delete' img.id %}"
                   class="absolute top-2 right-2 bg-red-600 text-white px-2 py-1 text-xs rounded opacity-0 
                   group-hover:opacity-100 transition">
                   Delete
                </a>
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <button type="submit"
            class="bg-blue-700 text-white px-6 py-2 rounded-lg hover:bg-blue-800 shadow">
        {% if product %}Update Product{% else %}Save Product{% endif %}
    </button>

</form>

{% endblock %}
