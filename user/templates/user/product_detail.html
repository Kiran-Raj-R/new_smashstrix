{% extends "base.html" %}
{% load static %}

{% block content %}

<div class="container mx-auto py-8">

    <div class="border-b pb-3 mb-6">
        <nav class="text-sm text-gray-700">
            <a href="/" class="hover:text-blue-600">Home</a> /
            <a href="{% url 'shop' %}" class="hover:text-blue-600">Shop</a> /
            <span class="text-gray-900 font-semibold">{{ product.name }}</span>
        </nav>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-10 border p-6 rounded-xl shadow-sm bg-white">
        <div>

            <div class="relative overflow-hidden rounded-xl shadow-md">
                <!-- Arrows -->
                <button id="prevBtn"
                    class="absolute left-3 top-1/2 -translate-y-1/2 bg-black/40 text-white px-3 py-2 rounded-full">
                    ‹
                </button>

                <img id="mainImage"
                     src="{{ product.images.first.image.url }}"
                     class="w-full h-96 object-cover transition-transform duration-300"
                     alt="{{ product.name }}">

                <button id="nextBtn"
                    class="absolute right-3 top-1/2 -translate-y-1/2 bg-black/40 text-white px-3 py-2 rounded-full">
                    ›
                </button>
            </div>

            <div class="flex gap-4 mt-4 overflow-x-auto pb-2">
                {% for img in product.images.all %}
                    <img src="{{ img.image.url }}"
                         class="thumb w-20 h-20 object-cover rounded-lg border cursor-pointer hover:ring-2 hover:ring-blue-500 transition">
                {% endfor %}
            </div>

        </div>

        <div class="space-y-4">

            <h1 class="text-3xl font-bold text-gray-800">{{ product.name }}</h1>

            <div class="flex items-center gap-2">
                <div class="flex text-yellow-400 text-xl">
                    {% for i in '12345' %}
                        {% if forloop.counter <= avg_rating %}
                            ★
                        {% else %}
                            ☆
                        {% endif %}
                    {% endfor %}
                </div>
                <p class="text-gray-600 text-sm">({{ total_reviews }} reviews)</p>
            </div>
            <div class="space-y-1">
                <p class="text-2xl font-bold text-green-700">₹{{ product.discount_price|default:product.price }}</p>

                {% if product.discount_price %}
                <p class="text-gray-500 line-through">₹{{ product.price }}</p>
                <p class="text-red-600 font-semibold text-sm">Limited Time Deal</p>
                {% endif %}
            </div>

            {% if product.colors.all %}
            <div class="border p-4 rounded-lg bg-gray-50">
                <h3 class="font-semibold mb-2">Available Colors</h3>

                <div class="space-y-3">
                    {% for cv in product.colors.all %}
                    <div class="flex items-center gap-3">
                        <div class="w-6 h-6 rounded-full shadow border"
                             style="background: {{ cv.color }}"></div>
                        <p class="text-gray-700 text-sm">
                            Stock: <b>{{ cv.stock }}</b>
                        </p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            <div class="flex gap-4 mt-4">
                <button class="bg-blue-700 text-white px-6 py-3 rounded-lg shadow hover:bg-blue-800">
                    Add to Cart
                </button>
                <button class="bg-green-600 text-white px-6 py-3 rounded-lg shadow hover:bg-green-700">
                    Buy Now
                </button>
            </div>

        </div>
    </div>

    <div class="mt-10 border p-6 rounded-xl bg-white shadow-sm">

        <div class="flex gap-8 border-b pb-2 mb-4">
            <button id="tabDesc" class="tab-btn font-semibold text-blue-700 border-b-2 border-blue-700">
                Description
            </button>
            <button id="tabReviews" class="tab-btn text-gray-600 hover:text-blue-600">
                Reviews
            </button>
        </div>

        <div id="descContent">
            <p class="text-gray-700 leading-relaxed">{{ product.description }}</p>
        </div>
        <div id="reviewContent" class="hidden">

            <h3 class="text-xl font-bold mb-4">Customer Reviews</h3>

            <div class="space-y-6">

                {% for r in review_list %}
                <div class="p-4 bg-gray-50 rounded-lg shadow-inner border">
                    <div class="flex justify-between items-center">
                        <h4 class="font-semibold">John Doe</h4>
                        <div class="text-yellow-400 text-lg">★★★★☆</div>
                    </div>
                    <p class="text-gray-700 mt-2">Amazing product! Build quality is excellent.</p>
                    <p class="text-gray-400 text-xs mt-1">Reviewed on Jan 20, 2024</p>
                </div>
                {% endfor %}

            </div>

        </div>

    </div>
    <div class="mt-14">
        <h2 class="text-2xl font-bold mb-6">Related Products</h2>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">

            {% for rp in related_products %}
            <a href="{% url 'product_detail' rp.id %}"
               class="bg-white border rounded-xl shadow-sm p-4 hover:shadow-md transition">
                <img src="{{ rp.images.first.image.url }}"
                     class="w-full h-40 object-cover rounded-lg">
                <h3 class="mt-3 font-semibold text-gray-800">{{ rp.name }}</h3>
                <p class="text-green-700 font-bold mt-1">₹{{ rp.discount_price|default:rp.price }}</p>
            </a>
            {% endfor %}

        </div>
    </div>

</div>

<script>
document.getElementById("tabDesc").onclick = () => {
    document.getElementById("descContent").classList.remove("hidden");
    document.getElementById("reviewContent").classList.add("hidden");
};

document.getElementById("tabReviews").onclick = () => {
    document.getElementById("descContent").classList.add("hidden");
    document.getElementById("reviewContent").classList.remove("hidden");
};

let images = Array.from(document.querySelectorAll(".thumb")).map(t => t.src);
let index = 0;

document.getElementById("prevBtn").onclick = () => {
    index = (index - 1 + images.length) % images.length;
    mainImage.src = images[index];
};
document.getElementById("nextBtn").onclick = () => {
    index = (index + 1) % images.length;
    mainImage.src = images[index];
};

mainImage.addEventListener("mousemove", (e) => {
    const rect = mainImage.getBoundingClientRect();
    const x = ((e.clientX - rect.left) / rect.width) * 100;
    const y = ((e.clientY - rect.top) / rect.height) * 100;
    mainImage.style.transformOrigin = `${x}% ${y}%`;
    mainImage.style.transform = "scale(2)";
});
mainImage.addEventListener("mouseleave", () => {
    mainImage.style.transform = "scale(1)";
});
</script>

{% endblock %}
